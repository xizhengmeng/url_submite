# 功能特性详解

## 📈 实时进度条

工具内置了实时进度条功能，让你直观地看到任务进度。

### Sitemap解析进度

当程序下载和解析sitemap时，会显示旋转动画：

```
📥 正在获取sitemap...
解析中 ⠋
  ✓ 找到 1,250 个URL
```

### URL提交进度

提交URL时会显示详细的进度条：

```
📤 开始提交...
  [百度] 准备提交 100 个URL
  [百度] [========>                    ] 100/100
  [百度] ✓ 成功: 98

  [Bing] 准备提交 200 个URL
  [Bing] [============================] 200/200
  [Bing] ✓ 成功: 200
```

进度条特点：
- 实时显示当前进度
- 显示已完成数量/总数量
- 完成后自动显示结果

---

## 📝 详细日志系统

工具会自动记录所有操作到日志文件，方便问题排查和历史追踪。

### 日志文件位置

```
data/logs/
├── 2026-01-23.log    # 今天的日志
├── 2026-01-22.log    # 昨天的日志
└── 2026-01-21.log    # 更早的日志
```

每天的日志自动保存到独立的文件中。

### 日志内容示例

```log
2026/01/23 15:30:00 [INFO] ========== 提交任务开始 ==========
2026/01/23 15:30:00 [INFO] 配置加载完成 - 文件: config/config.yaml, 网站数: 2
2026/01/23 15:30:00 [INFO] ---------- 开始处理网站: 示例网站 (example.com) ----------
2026/01/23 15:30:01 [INFO] Sitemap解析完成 - URL: https://example.com/sitemap.xml, 找到 1250 个URL
2026/01/23 15:30:01 [INFO] 历史记录加载 - 网站: example.com, 平台: baidu, 已提交: 850 个URL
2026/01/23 15:30:01 [INFO] URL过滤 - 网站: example.com, 平台: baidu, 总数: 1250, 待提交: 400
2026/01/23 15:30:01 [INFO] 开始提交 - 网站: example.com, 平台: baidu, URL数量: 100
2026/01/23 15:30:05 [SUCCESS] 提交完成 - 网站: example.com, 平台: baidu, 成功: 98
2026/01/23 15:30:05 [WARNING] 失败的URL列表:
2026/01/23 15:30:05 [WARNING]   - https://example.com/invalid-page-1
2026/01/23 15:30:05 [WARNING]   - https://example.com/invalid-page-2
2026/01/23 15:30:06 [INFO] 网站处理完成: 提交=300, 成功=298, 失败=2
2026/01/23 15:30:06 [INFO] ========== 提交任务完成 ==========
2026/01/23 15:30:06 [INFO] 总体统计: 提交=300, 成功=298, 失败=2
```

### 日志级别说明

| 级别 | 说明 | 用途 |
|------|------|------|
| **INFO** | 信息日志 | 记录正常的操作流程 |
| **SUCCESS** | 成功日志 | 记录成功的操作 |
| **WARNING** | 警告日志 | 记录警告信息和失败的URL |
| **ERROR** | 错误日志 | 记录错误和异常 |
| **DEBUG** | 调试日志 | 仅在verbose模式下显示 |

### 查看日志的方式

**1. 查看今天的日志**

```bash
cat data/logs/$(date +%Y-%m-%d).log
```

**2. 实时监控日志（在另一个终端）**

```bash
tail -f data/logs/$(date +%Y-%m-%d).log
```

**3. 查看最近的错误**

```bash
grep ERROR data/logs/$(date +%Y-%m-%d).log
```

**4. 查看某个网站的提交记录**

```bash
grep "example.com" data/logs/$(date +%Y-%m-%d).log
```

**5. 统计今天的成功率**

```bash
grep "SUCCESS" data/logs/$(date +%Y-%m-%d).log | wc -l
```

---

## 🔊 详细输出模式 (Verbose Mode)

使用 `-v` 或 `--verbose` 选项可以开启详细输出模式：

```bash
./submit-sitemap run -v
```

### 普通模式 vs 详细模式

**普通模式：**
- 只在控制台显示关键信息
- 所有详细日志写入文件
- 适合日常使用和定时任务

**详细模式：**
- 控制台和文件同时记录所有日志
- 实时看到所有操作细节
- 适合调试和问题排查

### 详细模式示例

```
🚀 URL提交工具启动...

2026/01/23 15:30:00 [INFO] ========== 提交任务开始 ==========
2026/01/23 15:30:00 [INFO] 配置加载完成 - 文件: config/config.yaml, 网站数: 1

📦 处理网站 [1/1]: 示例网站 (example.com)

2026/01/23 15:30:00 [INFO] ---------- 开始处理网站: 示例网站 (example.com) ----------

📥 正在获取sitemap...
  ✓ 找到 1,250 个URL

2026/01/23 15:30:01 [INFO] Sitemap解析完成 - URL: https://example.com/sitemap.xml, 找到 1250 个URL

📊 加载历史记录...
  • 百度: 已提交 850 个URL
  • Bing: 已提交 920 个URL

2026/01/23 15:30:01 [INFO] 历史记录加载 - 网站: example.com, 平台: baidu, 已提交: 850 个URL
2026/01/23 15:30:01 [INFO] 历史记录加载 - 网站: example.com, 平台: bing, 已提交: 920 个URL

📤 开始提交...
  [百度] 准备提交 100 个URL
2026/01/23 15:30:01 [INFO] 开始提交 - 网站: example.com, 平台: baidu, URL数量: 100
  [百度] [============================] 100/100
  [百度] ✓ 成功: 98
2026/01/23 15:30:05 [SUCCESS] 提交完成 - 网站: example.com, 平台: baidu, 成功: 98
  ...
```

---

## 📊 总体统计报告

每次运行结束后，程序会显示总体统计：

```
=============================================================
📊 总体统计:
  总提交: 300 个URL
  成功: 298
  失败: 2
  成功率: 99.3%
=============================================================

✨ 所有任务完成!
📝 详细日志: data/logs/2026-01-23.log
```

统计包括：
- **总提交**: 本次提交的总URL数量
- **成功**: 成功提交的数量
- **失败**: 失败的数量
- **成功率**: 成功率百分比

最后会提示日志文件位置，方便查看详情。

---

## 💡 实用技巧

### 1. 定时任务中使用日志

在crontab中运行时，日志会自动保存：

```bash
# crontab配置
0 9 * * * cd /path/to/submit-sitemap && ./submit-sitemap run

# 查看定时任务的结果
cat data/logs/$(date +%Y-%m-%d).log
```

### 2. 日志轮转

日志按天分割，旧日志会自动保留。如果需要清理：

```bash
# 删除30天前的日志
find data/logs/ -name "*.log" -mtime +30 -delete
```

### 3. 导出统计报告

从日志中提取统计信息：

```bash
# 统计本周提交情况
for i in {0..6}; do
  date=$(date -v-${i}d +%Y-%m-%d 2>/dev/null || date -d "${i} days ago" +%Y-%m-%d)
  echo "=== $date ==="
  grep "总体统计" data/logs/${date}.log 2>/dev/null || echo "无数据"
done
```

### 4. 监控失败URL

```bash
# 查看今天所有失败的URL
grep "失败的URL列表" -A 100 data/logs/$(date +%Y-%m-%d).log | grep "  -"
```

### 5. 性能分析

通过日志的时间戳分析各个步骤的耗时：

```bash
# 查看各个操作的时间
grep "开始\|完成" data/logs/$(date +%Y-%m-%d).log
```

---

## 🎯 最佳实践

1. **日常运行**: 使用普通模式，让程序在后台静默运行
2. **首次使用**: 使用详细模式(`-v`)，确认一切正常
3. **问题排查**: 使用详细模式，并实时查看日志文件
4. **定期检查**: 每周查看一次日志，确认提交状态
5. **日志清理**: 每月清理一次旧日志，节省磁盘空间

---

## 🆕 与旧版本对比

**v1.0（无进度条版本）**
```
📥 正在获取sitemap...
  ✓ 找到 1,250 个URL
  [百度] ✓ 成功: 98, 失败: 2
```

**v2.0（当前版本）**
```
📥 正在获取sitemap...
解析中 ⠋                           ← 新增：解析进度动画
  ✓ 找到 1,250 个URL
  [百度] [=====>           ] 50/100 ← 新增：实时进度条
  [百度] ✓ 成功: 98

📝 详细日志: data/logs/2026-01-23.log ← 新增：日志文件提示
```

新版本的改进：
- ✅ 实时进度反馈
- ✅ 详细的日志记录
- ✅ 更好的错误追踪
- ✅ 完整的操作历史
